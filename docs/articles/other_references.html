<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapping to other references â€¢ VoxHunt</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Mapping to other references">
<meta property="og:description" content="voxhunt">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">VoxHunt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/install.html">Install</a>
</li>
<li>
  <a href="../articles/getting_started.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting_started.html">Exploing the Allen Brain Atlas</a>
    </li>
    <li>
      <a href="../articles/other_references.html">Other references</a>
    </li>
    <li>
      <a href="../articles/deconvolution.html">Deconvolution</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://bsse.ethz.ch/qdb">
    <span class="fas fa-university fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/quadbiolab/VoxHunt">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="other_references_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mapping to other references</h1>
            
      
      
      <div class="hidden name"><code>other_references.Rmd</code></div>

    </div>

    
    
<div id="comparing-single-cell-data-to-brainspan" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-single-cell-data-to-brainspan" class="anchor"></a>Comparing single-cell data to BrainSpan</h2>
<p>You might want to compare your data also to human data instead of the mouse brain. Unfortunately, quantified and registered transcriptomic maps are not yet available for the developing human brain at this scale. However, we can compare cells to RNA-seq data of microdissected human brain regions from BrainSpan. The data is directly downloaded with VoxHunt.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/quadbiolab/VoxHunt">voxhunt</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">'brainspan'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">brainspan</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "matrix"   "row_meta" "col_meta"</code></pre>
<p>Before we compute similarities, we do some feature selection on to obtain a set of marker genes. In the future we will also implement the functionality to do this on the BrainSpan data. You could either do this youself or do feature selection on the ISH data, which we have found to work well.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regional_markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/structure_markers.html">structure_markers</a></span><span class="op">(</span><span class="st">'E13'</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">top_n</span><span class="op">(</span><span class="fl">10</span>, <span class="va">auc</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">gene</span><span class="op">)</span><span class="op">}</span></code></pre></div>
<p>Using these features, we can now construct a similarity map to stages pcw 10 - pcw 24. We also use the argument <code>pseudobulk_groups</code> to summarize the single cell data before calculating the correlation. This makes everything much faster and usually yields very similary results as mapping each cell individually.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ref_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brainspan_map.default.html">brainspan_map</a></span><span class="op">(</span>
    <span class="va">example_seurat</span>,
    stages <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">24</span>,
    group_name <span class="op">=</span> <span class="st">'cluster'</span>,
    genes_use <span class="op">=</span> <span class="va">regional_markers</span>,
    pseudobulk_groups <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ref_map</span><span class="op">)</span></code></pre></div>
<pre><code>## A BrainSpanMap object
## 3  mapped to
## 185 reference samples 
## based on 179 features</code></pre>
<p>And plot the similarity to the individual samples in brainspan categorized into structure groups:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="va">ref_map</span><span class="op">)</span></code></pre></div>
<p><img src="other_references_files/figure-html/unnamed-chunk-7-1.png" width="960"></p>
<p>We can again observe the patterns weâ€™ve seen when mapping to ISH data: Cortical neurons are highly correlated with the neocortex (NCx), diencephalic neurons with the dorsal thalamus (DTH) and GE neurons with the ganglionic eminences (GE) and the amygdala (AMY).</p>
<p>You can also plot the similarities summarized to structures, rather than for each individual sample.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_structure_similarity.html">plot_structure_similarity</a></span><span class="op">(</span><span class="va">ref_map</span>, annotation_level <span class="op">=</span> <span class="st">'structure_name'</span>, scale <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p><img src="other_references_files/figure-html/unnamed-chunk-8-1.png" width="249.6"></p>
</div>
<div id="mapping-to-developing-mouse-brain-scrna-seq-data-la-manno-siletti-et-al-" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-to-developing-mouse-brain-scrna-seq-data-la-manno-siletti-et-al-" class="anchor"></a>Mapping to developing mouse brain scRNA-seq data (La Manno &amp; Siletti et al.)</h2>
<p>The recently released scRNA-seq atlas of the developing mouse brain (<a href="https://www.biorxiv.org/content/10.1101/2020.07.02.184051v1">La Manno &amp; Siletti et al.</a>) provides a further great ressource for evaluating cell identity. The data from the preprint can be obtained <a href="http://mousebrain.org/downloads.html">here</a>. If after you downloaded both loom files to a directory, you can load it to be used by VoxHunt:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/load_mousebrain_data.html">load_mousebrain_data</a></span><span class="op">(</span><span class="st">'~/path/to/data'</span><span class="op">)</span></code></pre></div>
<p>After this, mapping your single cell data is as easy as calling</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mb_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mousebrain_map.html">mousebrain_map</a></span><span class="op">(</span><span class="va">example_seurat</span>, group_name <span class="op">=</span> <span class="st">'cluster'</span>, genes_use <span class="op">=</span> <span class="va">regional_markers</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">mb_map</span><span class="op">)</span></code></pre></div>
<pre><code>## A MousebrainMap object
## 3  mapped to
## 942 reference clusters 
## based on 176 features</code></pre>
<p>As with other maps, you can plot the object with</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="va">mb_map</span>, downsample<span class="op">=</span><span class="fl">50000</span>, point_size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<p><img src="other_references_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>and plot the similarity to different cell types with:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_structure_similarity.html">plot_structure_similarity</a></span><span class="op">(</span><span class="va">mb_map</span>, cluster <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p><img src="other_references_files/figure-html/unnamed-chunk-13-1.png" width="960"></p>
<p>For annotations of these maps, please have a look at the beautiful Figure 1 of the <a href="https://www.biorxiv.org/content/10.1101/2020.07.02.184051v1">preprint</a>.</p>
<p>Note 1: In this case, we only compute the similarity to aggregated clusters of the data, as correlation to &gt;300.000 cells is computationally quite intense. Further, the plotting function <code><a href="../reference/plot_map.html">plot_map()</a></code> takes an argument subsample, which allows downsampling the cells for faster plotting.</p>
<p>Note 2: The mapping functionality to this dataset is still pretty basic, considering how rich it is. This is partially because the publically available annotations are still quite coarse. We are working on this and will integrate it better in the future.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonas Simon Fleck.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
